{"version":3,"sources":["RungeKuttaSolver.js","Viewer.js","script.js"],"names":["add","v1","v2","map","e","i","add4","v3","v4","mul","k","v","module","exports","dt","x","f","t","dt2","dt6","step","k1","k2","k3","k4","getX","getTime","getR","m","Math","pow","PI","drawCenter","ctx","r","beginPath","arc","fill","drawArm","l","moveTo","lineTo","stroke","closePath","elementId","width","height","scale","canvas","document","getElementById","getContext","fillStyle","strokeStyle","draw","th1","l1","m1","th2","l2","m2","save","clearRect","translate","rotate","restore","RungeKuttaSolver","require","Viewer","info","random","min","max","g","m12","rks","sinX0","sin","sinX2","sinX02","cosX02","cos","vw","setInterval","dth1","dth2","v1x","v1y","v2x","v2y","p1y","p2y","E1","E2","U1","U2","innerHTML","toFixed","join"],"mappings":"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","file":"script.9ebc5cd8.js","sourceRoot":"..\\src","sourcesContent":["/*\r\n\tRunge–Kutta法による連立常微分方程式の計算\r\n\t2020/10/21 新規作成\r\n*/\r\n\r\n//[v1] + [v2]\r\nconst add = function(v1,v2){\r\n\treturn v1.map((e,i) => e + v2[i]);\r\n};\r\n\r\n//[v1] + [v2] + [v3] + [v4]\r\nconst add4 = function(v1,v2,v3,v4){\r\n\treturn v1.map((e,i) => e + v2[i] + v3[i] + v4[i]);\r\n};\r\n\r\n//k * [v]\r\nconst mul = function(k,v){\r\n\treturn v.map(e => e * k);\r\n};\r\n\r\nmodule.exports = function(dt,x,f){\r\n\t\r\n\tlet t = 0;\r\n\tconst dt2 = dt * 0.5;\r\n\tconst dt6 = dt / 6;\r\n\t\r\n\tthis.step = function(){\r\n\t\tconst k1 = f(t, x);\r\n\t\tconst k2 = f(t + dt2, add(x,mul(dt2,k1)));\r\n\t\tconst k3 = f(t + dt2, add(x,mul(dt2,k2)));\r\n\t\tconst k4 = f(t + dt, add(x,mul(dt,k3)));\r\n\t\t\r\n\t\tx = add(x,mul(dt6,add4(k1,mul(2,k2),mul(2,k3),k4)));\r\n\t\tt += dt;\r\n\t};\r\n\t\r\n\tthis.getX = function(){\r\n\t\treturn x;\r\n\t};\r\n\t\r\n\tthis.getTime = function(){\r\n\t\treturn t;\r\n\t};\r\n}","\r\n//質量m[kg]で密度d[km/m3]の球の半径\r\nconst getR = function(m){\r\n//\tconst d = 1000; //水\r\n\tconst d = 7870; //鉄\r\n\treturn Math.pow((m/d)*3/(4*Math.PI),1/3);\r\n};\r\n\r\n//中心を描く\r\nconst drawCenter = function(ctx,r){\r\n\tctx.beginPath();\r\n\tctx.arc(0,0,r,0,Math.PI * 2);\r\n\tctx.fill();\r\n};\r\n\r\n//振り子を描く\r\nconst drawArm = function(ctx,l,r){\r\n\tctx.beginPath();\r\n\tctx.moveTo(0,0);\r\n\tctx.lineTo(0,l);\r\n\tctx.stroke();\r\n\tctx.closePath();\r\n\t\r\n\tctx.beginPath();\r\n\tctx.arc(0,l,r,0,Math.PI * 2);\r\n\tctx.fill();\r\n};\r\n\r\n//表示画面\r\n//scale[px/m]\r\nmodule.exports = function(elementId,width,height,scale){\r\n\tconst canvas = document.getElementById(elementId);\r\n\tcanvas.width = width;\r\n\tcanvas.height = height;\r\n\t\r\n\tconst ctx = canvas.getContext(\"2d\");\r\n\tctx.fillStyle = \"rgba(0,0,0,1.0)\";\r\n\tctx.strokeStyle = \"rgba(0,0,0,1.0)\";\r\n\t\r\n\tthis.draw = function(th1,l1,m1,th2,l2,m2){\r\n\t\tctx.save();\r\n\t\tctx.clearRect(0,0,width,height);\r\n\t\tctx.translate(width * 0.5,height * 0.5);\r\n\t\t\r\n\t\tdrawCenter(ctx,5);\r\n\t\t\r\n\t\tctx.rotate(-th1);\r\n\t\tdrawArm(ctx,l1 * scale,getR(m1) * scale);\r\n\t\t\r\n\t\tctx.translate(0,l1 * scale);\r\n\t\tctx.rotate(th1 - th2);\r\n\t\tdrawArm(ctx,l2 * scale,getR(m2) * scale);\r\n\t\t\r\n\t\tctx.restore();\r\n\t};\r\n};\r\n\r\n","/*\r\n\t二重振り子シミュレーション\r\n\t2020/10/21 新規作成\r\n*/\r\n\r\nconst RungeKuttaSolver = require(\"./RungeKuttaSolver.js\");\r\nconst Viewer = require(\"./Viewer.js\");\r\n\r\nconst info = document.getElementById(\"info\");\r\n\r\n//min～maxのランダムな値\r\nconst random = function(min,max){\r\n\treturn (max - min) * Math.random() + min;\r\n};\r\n\r\n//条件\r\nconst m1 = random(1,5);\r\nconst l1 = random(0.1,0.9);\r\nconst th1 = random(-3,3);\r\n\r\nconst m2 = random(1,5);\r\nconst l2 = random(0.1,1.0 - l1);\r\nconst th2 = random(-3,3);\r\n\r\nconst g = 9.80665;\t//[m/s2]\r\nconst m12 = 1 + m1 / m2;\r\n\r\nconst rks = new RungeKuttaSolver(0.001,[th1,0,th2,0],function(t,x){\r\n\tconst sinX0 = Math.sin(x[0]);\r\n\tconst sinX2 = Math.sin(x[2]);\r\n\tconst sinX02 = Math.sin(x[0] - x[2]);\r\n\tconst cosX02 = Math.cos(x[0] - x[2]);\r\n\tconst k1 = l1 * Math.pow(x[1],2);\r\n\tconst k2 = l2 * Math.pow(x[3],2);\r\n\tconst f = m12 - Math.pow(cosX02,2);\r\n\t\r\n\treturn [\r\n\t\tx[1],\r\n\t\t(g * (sinX2 * cosX02 - m12 * sinX0) - (k2 + k1 * cosX02) * sinX02) / (l1 * f),\r\n\t\tx[3],\r\n\t\t(g * m12 * (sinX0 * cosX02 - sinX2) + (m12 * k1 + k2 * cosX02) * sinX02) / (l2 * f)\r\n\t];\r\n});\r\n\r\nconst vw = new Viewer(\"cv\",300,300,150);\r\n\r\nsetInterval(function(){\r\n\tconst th1 = rks.getX()[0];\r\n\tconst dth1 = rks.getX()[1];\r\n\tconst th2 = rks.getX()[2];\r\n\tconst dth2 = rks.getX()[3];\r\n\t\r\n\t//速度(x,yの各成分)\r\n\tconst v1x = l1 * dth1 * Math.cos(th1);\r\n\tconst v1y = l1 * dth1 * Math.sin(th1);\r\n\tconst v2x = v1x + l2 * dth2 * Math.cos(th2);\r\n\tconst v2y = v1y + l2 * dth2 * Math.sin(th2);\r\n\t\r\n\t//位置(y方向)\r\n\tconst p1y = -l1 * Math.cos(th1);\r\n\tconst p2y = p1y - l2 * Math.cos(th2);\r\n\t\r\n\t//運動エネルギー\r\n\tconst E1 = m1 * (v1x * v1x + v1y * v1y) * 0.5;\r\n\tconst E2 = m2 * (v2x * v2x + v2y * v2y) * 0.5;\r\n\t\r\n\t//位置エネルギー\r\n\tconst U1 = m1 * g * (l1 + p1y);\r\n\tconst U2 = m2 * g * (l1 + l2 + p2y);\r\n\t\r\n\t//表示\r\n\tvw.draw(th1,l1,m1,th2,l2,m2);\r\n\t\r\n\tinfo.innerHTML = [\r\n\t\t\"t[s]=\" + rks.getTime().toFixed(2),\r\n\t\t\"th1[rad]=\" + th1.toFixed(2),\r\n\t\t\"th1'[rad/s]=\" + dth1.toFixed(2),\r\n\t\t\"th2[rad]=\" + th2.toFixed(2),\r\n\t\t\"th2'[rad/s]=\" + dth2.toFixed(2),\r\n\t\t\"L1[m]=\" + l1.toFixed(2),\r\n\t\t\"M1[kg]=\" + m1.toFixed(2),\r\n\t\t\"L2[m]=\" + l2.toFixed(2),\r\n\t\t\"M2[kg]=\" + m2.toFixed(2),\r\n\t\t\"E[J]=\" + (E1 + E2 + U1 + U2).toFixed(4),\r\n\t].join(\"<br>\");\r\n\t\r\n\tfor(let i=0;i<30;i++) rks.step();\r\n},30)\r\n"]}